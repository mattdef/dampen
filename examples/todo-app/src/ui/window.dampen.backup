<?xml version="1.0" encoding="UTF-8" ?>
<dampen version="1.0">
    <!-- Theme Definitions - Material Design 3 Inspired -->
    <themes>
        <!-- Light Theme: Professional, high-contrast, accessible -->
        <theme name="light">
            <palette
                primary="#3498db"
                secondary="#2ecc71"
                success="#27ae60"
                warning="#f39c12"
                danger="#e74c3c"
                info="#5dade2"
                background="#ecf0f1"
                surface="#ffffff"
                surface_variant="#f8f9fa"
                text="#2c3e50"
                text_secondary="#7f8c8d"
                text_disabled="#bdc3c7"
                border="#dee2e6"
                shadow="rgba(44, 62, 80, 0.1)"
            />
            <typography
                font_family="Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif"
                font_size_base="16"
                font_size_small="12"
                font_size_medium="14"
                font_size_large="20"
                font_size_xlarge="24"
                font_size_xxlarge="32"
                font_weight="normal"
                font_weight_medium="500"
                font_weight_bold="700"
                line_height="1.5"
            />
            <spacing unit="8" />
        </theme>

        <!-- Dark Theme: Eye-friendly, modern, high-contrast -->
        <theme name="dark">
            <palette
                primary="#5dade2"
                secondary="#52be80"
                success="#27ae60"
                warning="#f39c12"
                danger="#ec7063"
                info="#85c1e9"
                background="#2c3e50"
                surface="#34495e"
                surface_variant="#2c3e50"
                text="#ecf0f1"
                text_secondary="#95a5a6"
                text_disabled="#7f8c8d"
                border="#4a5f7f"
                shadow="rgba(0, 0, 0, 0.3)"
            />
            <typography
                font_family="Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif"
                font_size_base="16"
                font_size_small="12"
                font_size_medium="14"
                font_size_large="20"
                font_size_xlarge="24"
                font_size_xxlarge="32"
                font_weight="normal"
                font_weight_medium="500"
                font_weight_bold="700"
                line_height="1.5"
            />
            <spacing unit="8" />
        </theme>
    </themes>

    <!-- Style Classes - Professional component styling -->
    <styles>
        <!-- Button Styles -->
        <style name="btn_primary">
            <base
                background="#3498db"
                color="#ffffff"
                padding="8 16"
                border_radius="6"
                border_width="0"
            />
            <hover background="#5dade2" />
            <active background="#2874a6" />
            <disabled opacity="0.5" />
        </style>

        <style name="btn_success">
            <base
                background="#27ae60"
                color="#ffffff"
                padding="8 16"
                border_radius="6"
                border_width="0"
            />
            <hover background="#52be80" />
            <active background="#1e8449" />
            <disabled opacity="0.5" />
        </style>

        <style name="btn_danger">
            <base
                background="#e74c3c"
                color="#ffffff"
                padding="8 16"
                border_radius="6"
                border_width="0"
            />
            <hover background="#ec7063" />
            <active background="#c0392b" />
            <disabled opacity="0.5" />
        </style>

        <style name="btn_outlined">
            <base
                background="transparent"
                color="#3498db"
                padding="8 16"
                border_radius="6"
                border_width="2"
                border_color="#3498db"
            />
            <hover background="#ebf5fb" border_color="#5dade2" />
            <active background="#d6eaf8" />
            <disabled opacity="0.3" />
        </style>

        <style name="btn_secondary">
            <base
                background="#7f8c8d"
                color="#ffffff"
                padding="8 16"
                border_radius="6"
                border_width="0"
            />
            <hover background="#95a5a6" />
            <active background="#6c7a7b" />
            <disabled opacity="0.5" />
        </style>

        <style name="btn_text">
            <base
                background="transparent"
                color="#3498db"
                padding="4 8"
                border_radius="4"
                border_width="0"
            />
            <hover background="#ebf5fb" />
            <active background="#d6eaf8" />
            <disabled opacity="0.3" />
        </style>

        <!-- Card Styles -->
        <style name="card">
            <base
                background="#ffffff"
                padding="20"
                border_radius="8"
                border_width="1"
                border_color="#dee2e6"
            />
        </style>

        <style name="card_dark">
            <base
                background="#34495e"
                padding="20"
                border_radius="8"
                border_width="1"
                border_color="#4a5f7f"
            />
        </style>

        <!-- Text Styles -->
        <style name="text_completed">
            <base
                color="#7f8c8d"
                text_decoration="line-through"
                opacity="0.7"
            />
        </style>

        <style name="text_secondary">
            <base
                color="#7f8c8d"
                size="14"
            />
        </style>

        <style name="text_heading">
            <base
                size="20"
                weight="bold"
                color="#2c3e50"
            />
        </style>

        <style name="text_danger">
            <base
                color="#e74c3c"
                weight="500"
            />
        </style>

        <style name="text_warning">
            <base
                color="#f39c12"
                weight="500"
            />
        </style>

        <!-- Input Styles -->
        <style name="input_primary">
            <base
                background="#ffffff"
                padding="8 12"
                border_radius="6"
                border_width="1"
                border_color="#dee2e6"
            />
            <focus border_color="#3498db" />
        </style>
    </styles>

    <!-- Set Global Theme -->
    <!-- Reactive theme binding - changes instantly when current_theme updates -->
    <global_theme name="{current_theme}" />

    <!-- Main UI -->
    <scrollable>
        <container padding="20">
            <column spacing="20">
                <!-- Header with title, statistics button, and dark mode toggle -->
                <row spacing="15" align="center">
                    <text value="Todo App" size="32" weight="bold" />
                    <space />
                    <button 
                        label="ðŸ“Š Statistics" 
                        on_click="open_statistics"
                        class="btn_outlined"
                    />
                    <toggler
                        label="Dark Mode"
                        on_toggle="toggle_dark_mode"
                        active="{dark_mode}"
                    />
                </row>

                <rule />

                <!-- Statistics Section with ProgressBar and Canvas (T110) -->
                <column spacing="10">
                    <text value="Statistics" size="20" weight="bold" />

                    <!-- Progress Bar showing completion percentage -->
                    <row spacing="10" align="center">
                        <text value="Overall Progress:" size="14" />
                        <progress_bar
                            min="0"
                            max="100"
                            value="{completion_percentage}"
                            style="success"
                        />
                        <text value="{completion_percentage}%" size="14" />
                    </row>

                    <!-- Completion message (T089 - US4) -->
                    <text 
                        value="{if completion_percentage == 100 then 'All tasks completed! ðŸŽ‰' else ''}"
                        size="16"
                        weight="bold"
                        align="center"
                    />

                    <!-- Statistics about items -->
                    <grid columns="6" spacing="15">
                        <text value="Total:" weight="bold" size="14" />
                        <text value="{items_len}" size="14" />
                        <text value="Active:" weight="bold" size="14" />
                        <!-- T098 - US4: Arithmetic expression alternative to computed field -->
                        <text value="{items_len - completed_count}" size="14" />
                        <text value="Completed:" weight="bold" size="14" />
                        <text value="{completed_count}" size="14" />
                    </grid>

                    <!-- Canvas for 7-day trend visualization -->
                    <canvas
                        width="400"
                        height="200"
                        program="{statistics_chart}"
                    />
                </column>

                <rule />

                <!-- Add Task Form with ComboBox and PickList (T111) -->
                <column spacing="10">
                    <text value="Add New Task" size="20" weight="bold" />

                    <row spacing="10">
                        <text_input
                            value="{new_item_text}"
                            on_input="update_new_item"
                            placeholder="What needs to be done?"
                        />
                        <tooltip
                            message="Add this task to your list"
                            position="top"
                        >
                            <button
                                label="Add Task"
                                on_click="add_item"
                                enabled="{new_item_text.len() > 0}"
                                class="btn_success"
                            />
                        </tooltip>
                    </row>

                    <!-- Input validation display (T097 - US4 Advanced Bindings) -->
                    <text 
                        value="Characters: {new_item_text.len()}/500"
                        size="12"
                        class="text_secondary"
                        align="end"
                    />

                    <!-- Category, Priority, and Filter Selection Grid -->
                    <grid columns="6" spacing="10">
                        <text value="Category:" size="14" />
                        <pick_list
                            options="Work,Personal,Shopping,Health,Finance,Other"
                            selected="{selected_category}"
                            on_select="update_category"
                        />

                        <text value="Priority:" size="14" />
                        <pick_list
                            options="Low,Medium,High"
                            selected="{selected_priority_display}"
                            on_select="update_priority"
                        />

                        <text value="Filter:" size="14" />
                        <pick_list
                            options="All,Active,Completed"
                            selected="{current_filter_display}"
                            on_select="apply_filter"
                        />
                    </grid>
                </column>

                <rule />

                <!-- Task List with Grid Layout and Dynamic Rendering (T112) -->
                <column spacing="10">
                    <text value="Your Tasks" size="20" weight="bold" />

                    <!-- Search input -->
                    <row spacing="10">
                        <text value="Search:" size="14" />
                        <text_input
                            value="{search_text}"
                            on_input="update_search"
                            placeholder="Search tasks, categories, or priorities..."
                        />
                    </row>

                    <!-- Show message if no items -->
                    <text
                        value="{if items_len == 0 then 'No tasks yet! Add one above to get started.' else ''}"
                        size="18"
                        align="center"
                    />

                    <!-- Task list with header and dynamic rows -->
                    <column spacing="10">
                        <!-- Header row -->
                        <row spacing="10">
                            <container width="50">
                                <text value="Status" weight="bold" size="14" />
                            </container>
                            <container width="200">
                                <text value="Task" weight="bold" size="14" />
                            </container>
                            <container width="100">
                                <text value="Category" weight="bold" size="14" />
                            </container>
                            <container width="80">
                                <text value="Priority" weight="bold" size="14" />
                            </container>
                            <container width="80">
                                <text value="Edit" weight="bold" size="14" />
                            </container>
                            <container width="80">
                                <text value="Delete" weight="bold" size="14" />
                            </container>
                        </row>

                        <rule />

                        <!-- Dynamic task rows using <for> loop -->
                        <for each="item" in="{filtered_items_cache}">
                            <row spacing="10">
                                <container width="50">
                                    <checkbox
                                        checked="{item.completed}"
                                        on_toggle="toggle_item:{item.id}"
                                    />
                                </container>
                                <container width="200">
                                    <text 
                                        value="{item.text}"
                                        class="{if item.completed then 'text_completed' else ''}"
                                    />
                                </container>
                                <container width="100">
                                    <text value="{item.category}" size="14" />
                                </container>
                                <container width="80">
                                    <text 
                                        value="{item.priority}" 
                                        size="14"
                                        class="{if item.priority == 'High' then 'text_danger' else if item.priority == 'Medium' then 'text_warning' else 'text_secondary'}"
                                    />
                                </container>
                                <container width="80">
                                    <button
                                        label="Edit"
                                        on_click="start_edit:{item.id}"
                                        class="btn_primary"
                                    />
                                </container>
                                <container width="80">
                                    <button
                                        label="Delete"
                                        on_click="delete_item:{item.id}"
                                        class="btn_danger"
                                    />
                                </container>
                            </row>
                        </for>
                    </column>

                    <!-- Edit dialog (shown when editing_id >= 0) -->
                    <text
                        value="{if editing_id >= 0 then 'Editing Task' else ''}"
                        size="18"
                        weight="bold"
                    />
                    <text
                        value="{if editing_id >= 0 then 'Edit the task text below:' else ''}"
                    />
                    <row spacing="10">
                        <text_input
                            value="{if editing_id >= 0 then edit_text else ''}"
                            on_input="update_edit_text"
                            placeholder="Task text..."
                        />
                        <button
                            label="Save"
                            on_click="save_edit"
                            enabled="{editing_id >= 0}"
                        />
                        <button
                            label="Cancel"
                            on_click="cancel_edit"
                            enabled="{editing_id >= 0}"
                        />
                    </row>

                    <text value="Total: {items_len} tasks" size="14" />
                </column>

                <rule />

                <!-- Actions with Tooltips (T113) -->
                <row spacing="10">
                    <tooltip
                        message="Remove all tasks from your list"
                        position="top"
                    >
                        <button
                            label="Clear All"
                            on_click="clear_all"
                            enabled="{items_len > 0}"
                        />
                    </tooltip>

                    <tooltip
                        message="Remove only completed tasks"
                        position="top"
                    >
                        <button
                            label="Clear Completed"
                            on_click="clear_completed"
                            enabled="{completed_count > 0}"
                            class="btn_danger"
                        />
                    </tooltip>

                    <space />

                    <text value="Total Tasks: {items_len}" size="14" />
                </row>

                <!-- Priority Icons Example (T114) -->
                <column spacing="10">
                    <text
                        value="Priority Indicators:"
                        size="16"
                        weight="bold"
                    />
                    <row spacing="20">
                        <column spacing="5" align="center">
                            <svg
                                src="examples/todo-app/assets/priority-low.svg"
                                width="32"
                                height="32"
                            />
                            <text value="Low" size="14" />
                        </column>
                        <column spacing="5" align="center">
                            <svg
                                src="examples/todo-app/assets/priority-medium.svg"
                                width="32"
                                height="32"
                            />
                            <text value="Medium" size="14" />
                        </column>
                        <column spacing="5" align="center">
                            <svg
                                src="examples/todo-app/assets/priority-high.svg"
                                width="32"
                                height="32"
                            />
                            <text value="High" size="14" />
                        </column>
                    </row>
                </column>

            </column>
        </container>
    </scrollable>
</dampen>
